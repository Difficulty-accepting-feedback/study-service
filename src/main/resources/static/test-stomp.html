<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>STOMP 테스트 클라이언트</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
<h1>STOMP 테스트 클라이언트</h1>
<button onclick="connect()">연결하기</button>
<button onclick="sendMessage()" disabled id="sendBtn">메시지 보내기</button>
<button onclick="disconnect()">연결 끊기</button>
<p>수신된 메시지: <span id="response"></span></p>

<script>
    let stompClient = null;
    const sendButton = document.getElementById('sendBtn');

    function connect() {
        const socket = new WebSocket('ws://localhost:8080/signaling');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function (frame) {
            console.log('STOMP 연결 성공: ' + frame);
            sendButton.disabled = false;  // 연결 후 버튼 활성화

            // /topic/test 토픽 구독: 서버가 브로드캐스트하는 메시지 수신
            stompClient.subscribe('/topic/test', function (message) {
                console.log('수신된 메시지: ' + message.body);
                document.getElementById('response').innerText = message.body;  // 화면에 표시
            });
        }, function (error) {
            console.error('STOMP 연결 오류: ' + error);
        });
    }

    function sendMessage() {
        if (stompClient) {
            const testMessage = 'Hello STOMP! This is a test message.';  // 보낼 메시지 (JSON으로도 가능)
            stompClient.send('/app/test', {}, testMessage);  // /app prefix + 매핑 경로로 전송
            console.log('메시지 전송: ' + testMessage);
        } else {
            console.error('먼저 연결하세요!');
        }
    }

    function disconnect() {
        if (stompClient) {
            stompClient.disconnect();
            console.log('STOMP 연결 끊김');
            sendButton.disabled = true;
        }
    }
</script>
</body>
</html>
